[
  {
    "objectID": "code/analysis/sac_fpt_ssc_turbidity.html",
    "href": "code/analysis/sac_fpt_ssc_turbidity.html",
    "title": "Sacramento River at Freeport SSC and Turbidity Data",
    "section": "",
    "text": "Code\n# Load packages\nlibrary(tidyverse)\nlibrary(khroma)\nlibrary(scales)\nlibrary(labelled)\nlibrary(car)\nlibrary(here)\nlibrary(conflicted)\n\n# Declare package conflict preferences\nconflicts_prefer(dplyr::filter())"
  },
  {
    "objectID": "code/analysis/sac_fpt_ssc_turbidity.html#suspended-sediment-concentration",
    "href": "code/analysis/sac_fpt_ssc_turbidity.html#suspended-sediment-concentration",
    "title": "Sacramento River at Freeport SSC and Turbidity Data",
    "section": "Suspended Sediment Concentration",
    "text": "Suspended Sediment Concentration\n\n\nCode\nls_sac_fpt_storm$ssc %&gt;% \n  ggplot(aes(x = Date, y = SSC)) +\n  geom_point() +\n  scale_x_date(breaks = breaks_pretty(15)) +\n  scale_y_continuous(labels = label_comma()) +\n  theme_bw() + \n  labs(\n    title = \"Sacramento River at Freeport\",\n    subtitle = \"Suspended Sediment Concentration\"\n  )"
  },
  {
    "objectID": "code/analysis/sac_fpt_ssc_turbidity.html#turbidity",
    "href": "code/analysis/sac_fpt_ssc_turbidity.html#turbidity",
    "title": "Sacramento River at Freeport SSC and Turbidity Data",
    "section": "Turbidity",
    "text": "Turbidity\n\n\nCode\nls_sac_fpt_storm$turb %&gt;% \n  ggplot(aes(x = Date, y = Turbidity)) +\n  geom_point() +\n  scale_x_date(breaks = breaks_pretty(10)) +\n  theme_bw() + \n  labs(\n    title = \"Sacramento River at Freeport\",\n    subtitle = \"Turbidity\"\n  )"
  },
  {
    "objectID": "code/analysis/sac_fpt_ssc_turbidity.html#all-data",
    "href": "code/analysis/sac_fpt_ssc_turbidity.html#all-data",
    "title": "Sacramento River at Freeport SSC and Turbidity Data",
    "section": "All Data",
    "text": "All Data\nStart with all the paired data:\n\n\nCode\nls_sac_fpt_storm$ssc_turb %&gt;% \n  ggplot(aes(x = SSC, y = Turbidity)) +\n  geom_point(alpha = 0.5) +\n  theme_bw() +\n  geom_smooth(method = \"lm\", formula = y ~ x) +\n  labs(\n    title = \"Sacramento River at Freeport\",\n    subtitle = \"SSC vs. Turbidity, Original values, All Data\"\n  )\n\n\n\n\n\n\n\n\n\nTry log-log transformation:\n\n\nCode\nls_sac_fpt_storm$ssc_turb %&gt;% \n  ggplot(aes(x = log(SSC), y = log(Turbidity))) +\n  geom_point(alpha = 0.5) +\n  theme_bw() +\n  geom_smooth(method = \"lm\", formula = y ~ x) +\n  labs(\n    title = \"Sacramento River at Freeport\",\n    subtitle = \"SSC vs. Turbidity, Log-transformed values, All Data\"\n  )\n\n\n\n\n\n\n\n\n\nThe relationship between SSC and Turbidity looks much clearer with the log-transformed data. Here is a simple linear model predicting Turbidity with SSC.\n\n\nCode\nlm_sac_fpt_ssc_turb_all &lt;- ls_sac_fpt_storm$ssc_turb %&gt;% lm(log(Turbidity) ~ log(SSC), data = .)\n\nsummary(lm_sac_fpt_ssc_turb_all)\n\n\n\nCall:\nlm(formula = log(Turbidity) ~ log(SSC), data = .)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-2.23359 -0.26780 -0.02425  0.26764  2.54686 \n\nCoefficients:\n             Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept) -0.449317   0.023810  -18.87   &lt;2e-16 ***\nlog(SSC)     0.847853   0.007718  109.86   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.5105 on 4888 degrees of freedom\nMultiple R-squared:  0.7117,    Adjusted R-squared:  0.7117 \nF-statistic: 1.207e+04 on 1 and 4888 DF,  p-value: &lt; 2.2e-16"
  },
  {
    "objectID": "code/analysis/sac_fpt_ssc_turbidity.html#just-storms",
    "href": "code/analysis/sac_fpt_ssc_turbidity.html#just-storms",
    "title": "Sacramento River at Freeport SSC and Turbidity Data",
    "section": "Just Storms",
    "text": "Just Storms\nNow restrict the correlation to just the defined storms:\n\n\nCode\nls_sac_fpt_storm$ssc_turb %&gt;% \n  filter(YSStorm == \"STORM\") %&gt;% \n  ggplot(aes(x = log(SSC), y = log(Turbidity))) +\n  geom_point(alpha = 0.5) +\n  theme_bw() +\n  geom_smooth(method = \"lm\", formula = y ~ x) +\n  labs(\n    title = \"Sacramento River at Freeport\",\n    subtitle = \"SSC vs. Turbidity, Log-transformed values, During storms\"\n  )\n\n\n\n\n\n\n\n\n\nHere is a simple linear model predicting Turbidity with SSC for just the defined storm periods:\n\n\nCode\nlm_sac_fpt_ssc_turb_storm &lt;- ls_sac_fpt_storm$ssc_turb %&gt;% \n  filter(YSStorm == \"STORM\") %&gt;%\n  lm(log(Turbidity) ~ log(SSC), data = .)\n\nsummary(lm_sac_fpt_ssc_turb_storm)\n\n\n\nCall:\nlm(formula = log(Turbidity) ~ log(SSC), data = .)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1.09334 -0.35729 -0.09015  0.34314  1.75388 \n\nCoefficients:\n            Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)  1.47418    0.30580   4.821 3.16e-06 ***\nlog(SSC)     0.55582    0.06621   8.395 1.76e-14 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.5623 on 170 degrees of freedom\nMultiple R-squared:  0.2931,    Adjusted R-squared:  0.2889 \nF-statistic: 70.47 on 1 and 170 DF,  p-value: 1.756e-14\n\n\nNow, try separating by first storm vs. all other storms:\n\n\nCode\nls_sac_fpt_storm$ssc_turb %&gt;% \n  filter(YSStorm == \"STORM\") %&gt;% \n  mutate(Storm_cat = fct_drop(Storm_cat)) %&gt;% \n  ggplot(aes(x = log(SSC), y = log(Turbidity), color = Storm_cat)) +\n  geom_point(alpha = 0.5) +\n  scale_color_highcontrast() +\n  theme_bw() +\n  geom_smooth(method = \"lm\", formula = y ~ x) +\n  labs(\n    title = \"Sacramento River at Freeport\",\n    subtitle = \"SSC vs. Turbidity, Log-transformed values, During storms\"\n  )\n\n\n\n\n\n\n\n\n\nThe slopes for each linear model appear parallel, but the First Storm intercept is higher. Let’s try a linear model adding Storm Category as a fixed effect.\n\n\nCode\nlm_sac_fpt_ssc_turb_storm_cat &lt;- ls_sac_fpt_storm$ssc_turb %&gt;% \n  filter(YSStorm == \"STORM\") %&gt;%\n  mutate(Storm_cat = fct_drop(Storm_cat)) %&gt;% \n  lm(log(Turbidity) ~ log(SSC) + Storm_cat, data = .)\n\nsummary(lm_sac_fpt_ssc_turb_storm_cat)\n\n\n\nCall:\nlm(formula = log(Turbidity) ~ log(SSC) + Storm_cat, data = .)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1.06899 -0.40920 -0.06721  0.30688  1.80237 \n\nCoefficients:\n                              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)                    2.14552    0.33711   6.364 1.78e-09 ***\nlog(SSC)                       0.47030    0.06690   7.030 4.87e-11 ***\nStorm_catStorm, but not first -0.38879    0.09658  -4.026 8.56e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.5387 on 169 degrees of freedom\nMultiple R-squared:  0.3549,    Adjusted R-squared:  0.3473 \nF-statistic: 46.49 on 2 and 169 DF,  p-value: &lt; 2.2e-16\n\n\nCode\nAnova(lm_sac_fpt_ssc_turb_storm_cat, type = 2)\n\n\nAnova Table (Type II tests)\n\nResponse: log(Turbidity)\n          Sum Sq  Df F value    Pr(&gt;F)    \nlog(SSC)  14.344   1  49.425 4.866e-11 ***\nStorm_cat  4.703   1  16.205 8.565e-05 ***\nResiduals 49.048 169                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\nIt looks like the intercept for the “Storm, but not first” category is significantly lower than the intercept for the “First Storm”."
  },
  {
    "objectID": "code/analysis/sac_fpt_ssc_turbidity.html#just-winter-early-spring",
    "href": "code/analysis/sac_fpt_ssc_turbidity.html#just-winter-early-spring",
    "title": "Sacramento River at Freeport SSC and Turbidity Data",
    "section": "Just Winter-Early Spring",
    "text": "Just Winter-Early Spring\nMaybe restricting the correlation to just the defined storms is too restrictive. Let’s try restricting the data to the months when storms are most prevalent, but include data outside of defined storms.\n\n\nCode\ndf_sac_storm %&gt;% \n  filter(YSStorm == \"STORM\") %&gt;%\n  count(Month)\n\n\n# A tibble: 10 × 2\n   Month     n\n   &lt;dbl&gt; &lt;int&gt;\n 1     1   380\n 2     2   353\n 3     3   311\n 4     4   119\n 5     5    50\n 6     6    14\n 7     7     1\n 8    10     7\n 9    11    79\n10    12   296\n\n\nIt looks like storms are most common during December - April, so we’ll use that time period.\n\n\nCode\nls_sac_fpt_storm$ssc_turb %&gt;% \n  filter(Month %in% c(1:4, 12)) %&gt;% \n  ggplot(aes(x = log(SSC), y = log(Turbidity))) +\n  geom_point(alpha = 0.5) +\n  theme_bw() +\n  geom_smooth(method = \"lm\", formula = y ~ x) +\n  labs(\n    title = \"Sacramento River at Freeport\",\n    subtitle = \"SSC vs. Turbidity, Log-transformed values, December - April\"\n  )\n\n\n\n\n\n\n\n\n\nHere is a simple linear model predicting Turbidity with SSC for December - April data:\n\n\nCode\nlm_sac_fpt_ssc_turb_wint &lt;- ls_sac_fpt_storm$ssc_turb %&gt;% \n  filter(Month %in% c(1:4, 12)) %&gt;% \n  lm(log(Turbidity) ~ log(SSC), data = .)\n\nsummary(lm_sac_fpt_ssc_turb_wint)\n\n\n\nCall:\nlm(formula = log(Turbidity) ~ log(SSC), data = .)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-2.45176 -0.24646 -0.01933  0.28302  2.33503 \n\nCoefficients:\n            Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept) -0.25254    0.04409  -5.728 1.17e-08 ***\nlog(SSC)     0.85174    0.01243  68.546  &lt; 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.5354 on 2055 degrees of freedom\nMultiple R-squared:  0.6957,    Adjusted R-squared:  0.6956 \nF-statistic:  4699 on 1 and 2055 DF,  p-value: &lt; 2.2e-16\n\n\nNow, try separating by first storm vs. all other storms vs. no storm:\n\n\nCode\nls_sac_fpt_storm$ssc_turb %&gt;% \n  filter(Month %in% c(1:4, 12)) %&gt;% \n  mutate(\n    Storm_cat = fct_collapse(\n      Storm_cat, \n      \"No Storm\" = c(\"No Storm, during winter\", \"No Storm, not during winter\")\n    )\n  ) %&gt;% \n  ggplot(aes(x = log(SSC), y = log(Turbidity), color = Storm_cat)) +\n  geom_point(alpha = 0.5) +\n  scale_color_highcontrast() +\n  theme_bw() +\n  geom_smooth(method = \"lm\", formula = y ~ x) +\n  labs(\n    title = \"Sacramento River at Freeport\",\n    subtitle = \"SSC vs. Turbidity, Log-transformed values, December - April\"\n  )\n\n\n\n\n\n\n\n\n\nThe relationships between Turbidity and SSC look very similar between all data and when its restricted to December - April. Either one of these linear models would probably work well to estimate turbidity from SSC."
  },
  {
    "objectID": "code/analysis/sac_fpt_ssc_turbidity.html#suspended-sediment-concentration-1",
    "href": "code/analysis/sac_fpt_ssc_turbidity.html#suspended-sediment-concentration-1",
    "title": "Sacramento River at Freeport SSC and Turbidity Data",
    "section": "Suspended Sediment Concentration",
    "text": "Suspended Sediment Concentration\n\n\nCode\nls_sac_fpt_storm$ssc %&gt;% \n  ggplot(aes(x = Storm_cat, y = SSC)) +\n  geom_boxplot() +\n  scale_y_continuous(labels = label_comma()) +\n  theme_bw() +\n  labs(\n    title = \"Sacramento River at Freeport\",\n    subtitle = \"Suspended Sediment comparison between storm categories\"\n  )\n\n\n\n\n\n\n\n\n\nCode\nls_sac_fpt_storm$ssc %&gt;% \n  ggplot(aes(x = Storm_cat, y = SSC)) +\n  geom_violin(quantile.linetype = 1) +\n  scale_y_continuous(labels = label_comma()) +\n  theme_bw() +\n  labs(\n    title = \"Sacramento River at Freeport\",\n    subtitle = \"Suspended Sediment comparison between storm categories\"\n  )\n\n\n\n\n\n\n\n\n\n\n\nCode\nls_sac_fpt_storm$ssc %&gt;% \n  filter(YSStorm == \"STORM\") %&gt;% \n  mutate(Storm_cat = fct_drop(Storm_cat)) %&gt;% \n  ggplot(aes(x = YoloSac, y = SSC, color = Storm_cat)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(method = \"lm\", formula = y ~ x) +\n  scale_color_highcontrast(name = \"Storm Category\") +\n  scale_x_continuous(labels = label_comma()) +\n  scale_y_continuous(labels = label_comma()) +\n  theme_bw() +\n  labs(\n    title = \"Sacramento River at Freeport\",\n    subtitle = \"Sac + Yolo Flow vs. SSC\"\n  )"
  },
  {
    "objectID": "code/analysis/sac_fpt_ssc_turbidity.html#turbidity-1",
    "href": "code/analysis/sac_fpt_ssc_turbidity.html#turbidity-1",
    "title": "Sacramento River at Freeport SSC and Turbidity Data",
    "section": "Turbidity",
    "text": "Turbidity\n\n\nCode\nls_sac_fpt_storm$turb %&gt;% \n  ggplot(aes(x = Storm_cat, y = Turbidity)) +\n  geom_boxplot() +\n  theme_bw() +\n  labs(\n    title = \"Sacramento River at Freeport\",\n    subtitle = \"Turbidity comparison between storm categories\"\n  )\n\n\n\n\n\n\n\n\n\nCode\nls_sac_fpt_storm$turb %&gt;% \n  ggplot(aes(x = Storm_cat, y = Turbidity)) +\n  geom_violin(quantile.linetype = 1) +\n  theme_bw() +\n  labs(\n    title = \"Sacramento River at Freeport\",\n    subtitle = \"Turbidity comparison between storm categories\"\n  )\n\n\n\n\n\n\n\n\n\n\n\nCode\nls_sac_fpt_storm$turb %&gt;% \n  filter(YSStorm == \"STORM\") %&gt;% \n  mutate(Storm_cat = fct_drop(Storm_cat)) %&gt;% \n  ggplot(aes(x = YoloSac, y = Turbidity, color = Storm_cat)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(method = \"lm\", formula = y ~ x) +\n  scale_color_highcontrast(name = \"Storm Category\") +\n  scale_x_continuous(labels = label_comma()) +\n  scale_y_continuous(labels = label_comma()) +\n  theme_bw() +\n  labs(\n    title = \"Sacramento River at Freeport\",\n    subtitle = \"Sac + Yolo Flow vs. Turbidity\"\n  )"
  },
  {
    "objectID": "code/analysis/sac_fpt_ssc_turbidity.html#ssc-restricted-to-turbidity-por",
    "href": "code/analysis/sac_fpt_ssc_turbidity.html#ssc-restricted-to-turbidity-por",
    "title": "Sacramento River at Freeport SSC and Turbidity Data",
    "section": "SSC restricted to Turbidity POR",
    "text": "SSC restricted to Turbidity POR\nSuspended sediment concentration has a much longer period of record than Turbidity. What does this first flush analysis look like if we restricted the SSC values to the period of record for Turbidity.\n\n\nCode\nturb_por &lt;- interval(min(ls_sac_fpt_storm$turb$Date), max(ls_sac_fpt_storm$turb$Date))\n\ndf_sac_fpt_ssc_storm_rst &lt;- ls_sac_fpt_storm$ssc %&gt;% filter(Date %within% turb_por)\n\n\n\n\nCode\ndf_sac_fpt_ssc_storm_rst %&gt;% \n  ggplot(aes(x = Storm_cat, y = SSC)) +\n  geom_boxplot() +\n  scale_y_continuous(labels = label_comma()) +\n  theme_bw() +\n  labs(\n    title = \"Sacramento River at Freeport\",\n    subtitle = \"Suspended Sediment comparison between storm categories, restricted period of record\"\n  )\n\n\n\n\n\n\n\n\n\nCode\ndf_sac_fpt_ssc_storm_rst %&gt;% \n  ggplot(aes(x = Storm_cat, y = SSC)) +\n  geom_violin(quantile.linetype = 1) +\n  scale_y_continuous(labels = label_comma()) +\n  theme_bw() +\n  labs(\n    title = \"Sacramento River at Freeport\",\n    subtitle = \"Suspended Sediment comparison between storm categories, restricted period of record\"\n  )\n\n\n\n\n\n\n\n\n\n\n\nCode\ndf_sac_fpt_ssc_storm_rst %&gt;% \n  filter(YSStorm == \"STORM\") %&gt;% \n  mutate(Storm_cat = fct_drop(Storm_cat)) %&gt;% \n  ggplot(aes(x = YoloSac, y = SSC, color = Storm_cat)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(method = \"lm\", formula = y ~ x) +\n  scale_color_highcontrast(name = \"Storm Category\") +\n  scale_x_continuous(labels = label_comma()) +\n  scale_y_continuous(labels = label_comma()) +\n  theme_bw() +\n  labs(\n    title = \"Sacramento River at Freeport\",\n    subtitle = \"Sac + Yolo Flow vs. SSC, restricted period of record\"\n  )"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "First Flush Synthesis",
    "section": "",
    "text": "Data Exploration:\n\nInteractive Continuous WQ Map\nSR at Freeport SSC and Turbidity"
  },
  {
    "objectID": "code/analysis/cont_wq_maps.html",
    "href": "code/analysis/cont_wq_maps.html",
    "title": "Continuous Water Quality Station Maps",
    "section": "",
    "text": "Code\n# Load packages\nlibrary(tidyverse)\nlibrary(viridisLite)\nlibrary(sf)\nlibrary(mapview)\nlibrary(here)\nlibrary(conflicted)\n\n# Declare package conflict preferences\nconflicts_prefer(dplyr::filter())\n\n\n\nImport and Prepare Data\n\n\nCode\n# Import continuous WQ station coordinates\nsf_stations &lt;- read_sf(here(\"data/processed/spatial/cont_wq_stations.shp\"))\n\n# Import continuous WQ station metadata\ndf_metadata &lt;- readRDS(here(\"data/processed/wq/cont_wq_metadata.rds\"))\n\n# Add metadata to station coordinates\nsf_stations_c1 &lt;- sf_stations %&gt;% left_join(df_metadata, by = join_by(Source, Station_ID))\n\n\n\n\nInteractive Maps\n\n\nCode\nndf_maps &lt;- sf_stations_c1 %&gt;% \n  nest(sf_data = everything(), .by = Parameter) %&gt;% \n  arrange(Parameter) %&gt;% \n  mutate(\n    maps = map(\n      sf_data,\n      \\(x) mapview(\n        x, zcol = \"Source\", col.regions = plasma(n = 5),\n        label = \"Station_Name\", layer.name = \"Source\", cex = 5\n      )\n    )\n  )\n\n\n\nChlorophyllDissolved OxygenSpecific ConductanceSuspended Sediment ConcTurbidityWater TemperaturepH"
  }
]