---
title: "Continuous Water Quality Station Maps"
author: "Dave Bosworth"
date: today
date-format: long
format:
  html:
    code-fold: true
    code-tools: true
execute: 
  message: false
  warning: false
---

```{r}
# Load packages
library(tidyverse)
library(viridisLite)
library(sf)
library(mapview)
library(here)
library(conflicted)

# Declare package conflict preferences
conflicts_prefer(dplyr::filter())
```

# Import and Prepare Data

```{r}
# Import continuous WQ station coordinates
sf_stations <- read_sf(here("data/processed/spatial/cont_wq_stations.shp"))

# Import continuous WQ station metadata
df_metadata <- readRDS(here("data/processed/wq/cont_wq_metadata.rds"))

# Add metadata to station coordinates
sf_stations_c1 <- sf_stations %>% left_join(df_metadata, by = join_by(Source, Station_ID))
```

# Interactive Maps

```{r}
ndf_maps <- sf_stations_c1 %>% 
  nest(sf_data = everything(), .by = Parameter) %>% 
  arrange(Parameter) %>% 
  mutate(
    maps = map(
      sf_data,
      \(x) mapview(
        x, zcol = "Source", col.regions = plasma(n = 5),
        label = "Station_Name", layer.name = "Source", cex = 5
      )
    )
  )
```

::: {.panel-tabset}

## `r ndf_maps$Parameter[1]`

```{r}
#| echo: false

ndf_maps$maps[[1]]
```

## `r ndf_maps$Parameter[2]`

```{r}
#| echo: false

ndf_maps$maps[[2]]
```

## `r ndf_maps$Parameter[3]`

```{r}
#| echo: false

ndf_maps$maps[[3]]
```

## `r ndf_maps$Parameter[4]`

```{r}
#| echo: false

ndf_maps$maps[[4]]
```

## `r ndf_maps$Parameter[5]`

```{r}
#| echo: false

ndf_maps$maps[[5]]
```

## `r ndf_maps$Parameter[6]`

```{r}
#| echo: false

ndf_maps$maps[[6]]
```

## `r ndf_maps$Parameter[7]`

```{r}
#| echo: false

ndf_maps$maps[[7]]
```

:::

